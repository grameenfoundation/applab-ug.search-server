TABLE MODIFICATIONS

1.	ALTER TABLE keyword CHANGE aliases aliases TEXT;
ALTER TABLE keyword DROP INDEX keyword;
ALTER TABLE keyword CHANGE keyword keyword TEXT;
ALTER TABLE keyword ADD UNIQUE KEY `keyword` (`keyword`(767));
ALTER TABLE keyword CHANGE content content TEXT;
ALTER TABLE message ADD senderPhoneNumber varchar(128) NOT NULL default '';
ALTER TABLE message CHANGE message message TEXT;

2.	ALTER TABLE keyword ADD quizAction_action varchar(128) NOT NULL default '';
ALTER TABLE keyword ADD quizAction_quizId int unsigned NOT NULL default '0';

3.	alter table quiz add singleKeyword tinyint unsigned not null default 0 after reply;
alter table quiz add keyword varchar(50) default null after singleKeyword;
alter table quiz add constraint unique key(keyword);
alter table question add no int unsigned default null after wrongReply;

4.	ALTER TABLE message ADD messageStatus tinyint unsigned not null default '1';


--
CREATE TABLE `eresult` (
  `id` bigint(20) unsigned NOT NULL auto_increment,
  `date` datetime NOT NULL,
  `surveyId` bigint(20) unsigned NOT NULL,
  `name` varchar(100) NOT NULL,
  `fieldcode` varchar(100) NOT NULL,
  `fieldtype` varchar(50) NOT NULL,
  `fieldvalue` varchar(100) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  KEY `surveyId` (`surveyId`),
  CONSTRAINT `eresult_ibfk_1` FOREIGN KEY (`surveyId`) REFERENCES `msurvey` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

alter table eresult add constraint foreign key(surveyId) references msurvey(id);
alter table msurvey add useraccess tinyint unsigned not null default 0 after active;
alter table msurvey add logic text default null after fif;
alter table msurvey add updatelogic tinyint unsigned not null default 0;
alter table admin add type enum ('ADMINISTRATOR', 'LIMITED_USER') NOT NULL DEFAULT 'ADMINISTRATOR' AFTER email;
alter table sessions modify type enum('ADMINISTRATOR', 'LIMITED_USER') NOT NULL DEFAULT 'ADMINISTRATOR';
alter table sessions add updated timestamp not null;

-- 11th Jun, 2009

CREATE TABLE `logic` (
  `id` bigint(20) unsigned NOT NULL auto_increment,
  `createdate` datetime NOT NULL,
  `surveyId` bigint(20) unsigned NOT NULL,
  `logic` text,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  KEY `surveyId` (`surveyId`),
  FOREIGN KEY (`surveyId`) REFERENCES `msurvey` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

5. ALTER TABLE keyword ADD keywordAlias text AFTER aliases;

-- 25th June 2009

CREATE TABLE `user` (
  `id` bigint(20) unsigned NOT NULL auto_increment,
  `createdate` datetime NOT NULL,
  `names` varchar(100) default NULL,
  `misdn` varchar(30) NOT NULL,
  `phones` varchar(100) default NULL COMMENT 'Other phone number for this user',
  `gender` enum('Male','Female') default NULL,
  `dob` date NOT NULL default '0000-00-00',
  `occupation` varchar(100) default NULL,
  `location` varchar(50) default NULL,
  `initiativeInfo` varchar(255) default NULL,
  `deviceInfo` varchar(100) default NULL,
  `notes` varchar(255) default NULL,
  `hits` int(10) unsigned NOT NULL default '0',
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `misdn` (`misdn`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COMMENT='Associates Phone numbers with user information';

-- 26th June 2009

CREATE TABLE `workinglist` (
  `phone` varchar(20) NOT NULL,
  `createdate` datetime NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  UNIQUE KEY `phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- 16th Jul, 2009

CREATE TABLE `initiative` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `name` varchar(100) NOT NULL,
  `description` text,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

alter table user add initiativeId int unsigned default null after initiativeInfo;
alter table user add constraint foreign key(initiativeId) references initiative(id);

-- 31st Jul, 2009

ALTER TABLE smslog CHANGE message message TEXT;
ALTER TABLE smslog ADD KEY `date` (`date`);
ALTER TABLE quizreply ADD KEY `questionId` (`questionId`);
ALTER TABLE quizreply ADD KEY `id_key` (`id`);
ALTER TABLE sresult ADD KEY `id_key` (`id`);
ALTER TABLE mresult ADD KEY `id_key` (`id`);
ALTER TABLE hit ADD KEY `id_key` (`id`);

-- 4th August 2009

CREATE TABLE `normalizedKeywords` (
  `id` bigint(20) NOT NULL auto_increment,
  `keywordId` int(10) unsigned NOT NULL default '0',
  `normalizedKeyword` varchar(128) NOT NULL default '',
  `wordCount` int(10) unsigned NOT NULL default '0',
  PRIMARY KEY  (`id`),
  UNIQUE KEY `ensureNoDup` (`keywordId`,`normalizedKeyword`),
  CONSTRAINT `normalizedKeywords_ibfk_1` FOREIGN KEY (`keywordId`) REFERENCES `keyword` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- 6th August 2009

ALTER TABLE keyword ADD optionalWords TEXT AFTER keywordAlias;

-- 10th August 2009

CREATE TABLE IF NOT EXISTS smsForward (
	id int unsigned NOT NULL auto_increment primary key,
	description varchar(255) not null default '',
	notes text not null default '',
	shortCode varchar(128) not null default '',
	keyword varchar(128) not null default '',
	createdate datetime not null default '0000-00-00',
	url text not null default '',
	method tinyint unsigned not null default '0',
	httpVars text not null default ''
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- 18th Aug 2009

CREATE TABLE `district` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `created` datetime NOT NULL,
  `name` varchar(100) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE `subcounty` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `created` datetime NOT NULL,
  `districtId` int(10) unsigned NOT NULL,
  `name` varchar(100) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `districtId` (`districtId`,`name`),
  CONSTRAINT `subcounty_ibfk_1` FOREIGN KEY (`districtId`) REFERENCES `district` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE `occupation` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `created` datetime NOT NULL,
  `name` varchar(100) NOT NULL,
  `description` text,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

alter table user add occupationId int unsigned default null after occupation;
alter table user add constraint foreign key(occupationId) references occupation(id);
alter table user add subcountyId int unsigned default null after dob;
alter table user add constraint foreign key(subcountyId) references subcounty(id);
alter table user add gpscordinates varchar(80) default null after deviceInfo;
alter table user add groups varchar(80) default null after subcountyId;

-- 20th August 2009
ALTER TABLE mresult ADD surveySignature varchar(128) NOT NULL AFTER form;

--- 24th August 2009
ALTER TABLE user MODIFY groups varchar(255) default null;

-- 26th Aug
alter table workinglist drop index phone;
alter table workinglist add owner int unsigned not null after phone;
alter table workinglist add foreign key(owner) references admin(id);
alter table workinglist add constraint unique key(owner, phone);

---27th August 2009
ALTER TABLE smsForward ADD newBnumber varchar(128) NOT NULL default '' AFTER keyword;

-- 30th Aug, 2009

CREATE TABLE `GoogleSMS6001` (
  `id` bigint(20) unsigned NOT NULL auto_increment,
  `date` datetime NOT NULL,
  `logdate` datetime NOT NULL,
  `misdn` varchar(30) NOT NULL,
  `site` varchar(128) default NULL,
  `location` varchar(128) default NULL,
  `importID` varchar(128) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE `HealthIVR` (
  `id` bigint(20) unsigned NOT NULL auto_increment,
  `date` datetime NOT NULL,
  `logdate` datetime NOT NULL,
  `misdn` varchar(30) NOT NULL,
  `duration` int(10) unsigned default NULL,
  `importID` varchar(128) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE `vAppUploadLog` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `date` datetime NOT NULL,
  `filename` varchar(255) NOT NULL,
  `application` varchar(128) NOT NULL,
  `fileSignature` varchar(128) NOT NULL,
  `importID` varchar(128) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE `oldFormSurveys` (
  `id` bigint(20) unsigned NOT NULL auto_increment,
  `date` datetime NOT NULL,
  `logdate` datetime NOT NULL,
  `msisdn` varchar(30) NOT NULL,
	`otherInfo` text,
  `importID` varchar(128) NOT NULL,
  `updated` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- 17/02/2010
ALTER TABLE keyword ADD attribution TEXT;

CREATE TABLE GlobalSettings (
  attribution tinyint unsigned not null default '0'
) Engine=InnoDB;

-- 30/03/2010

CREATE TABLE OktopusSearchLog (
`id` bigint(20) unsigned NOT NULL auto_increment,
`server_entry_time` datetime NOT NULL default '0000-00-00 00:00:00',
`handset_submit_time` datetime NOT NULL default '0000-00-00 00:00:00',
`handset_id` varchar(255) not null default '',
`interviewee_id` varchar(255) not null default '',
`location` varchar(255) not null default '',
`status` enum('SUCCEEDED', 'FAILED') not null default 'SUCCEEDED',
`query` varchar(255) not null default '',
`content` text not null default '',
`interviewer_id` varchar(255) not null default '',
`interviewer_name` varchar(255) not null default '',
PRIMARY KEY (`id`)
) Engine=InnoDB;
